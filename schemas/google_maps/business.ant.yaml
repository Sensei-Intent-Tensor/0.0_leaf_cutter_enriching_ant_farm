# ğŸœ Google Maps Business Schema
# Ant ID: google_maps.business
# Version: 2.0
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

schema_version: "2.0"
platform: google_maps
entity: business_listing
description: "Extract business listings from Google Maps search results"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SEARCH CONFIGURATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

search:
  input_format: "{industry} near {city}, {state} {country}"
  search_url: "https://www.google.com/maps?hl=en"
  
  # Input field definitions for UI
  inputs:
    - name: industry
      label: "Industry/Business Type"
      placeholder: "e.g., tattoo, coffee shop, dentist"
      required: true
    - name: city
      label: "City"
      placeholder: "e.g., Dallas"
      required: true
    - name: state
      label: "State"
      placeholder: "e.g., TX"
      required: true
    - name: country
      label: "Country"
      placeholder: "e.g., USA"
      required: false
      default: "USA"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PAGINATION CONFIGURATION
# Google Maps uses infinite scroll - no URL parameters
# Results load as you scroll the left panel
# Maximum ~120 results per search query
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

pagination:
  type: infinite_scroll
  results_per_page: 20
  
  infinite_scroll:
    # The scrollable results container
    container: 'div[role="feed"]'
    
    # Alternative container selectors (fallbacks)
    container_fallbacks:
      - 'div.m6QErb[aria-label]'
      - 'div.m6QErb.DxyBCb'
    
    # Text that appears when no more results
    end_marker: "You've reached the end of the list"
    
    # Alternative end markers
    end_marker_fallbacks:
      - "No results found"
      - "end of the list"
      
    # Milliseconds to wait between scrolls (let results load)
    scroll_delay: 2000
    
    # Maximum scroll attempts (safety limit)
    max_scrolls: 50
    
    # Pixels to scroll each time
    scroll_amount: 800
    
  # User-controllable pagination inputs
  inputs:
    - name: max_results
      label: "Max Results"
      type: number
      default: 20
      min: 3
      max: 120
      description: "Google Maps limits ~120 results per search. For more, narrow your search area."

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# EXTRACTION CONFIGURATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

extraction:
  engine: playwright
  
  # Navigation flow
  navigation:
    wait_for: '#searchboxinput'
    search_input: '#searchboxinput'
    search_submit: 'Enter'
    results_wait: 4000
    
  # Result item selectors (in the list)
  result_item:
    selector: 'a[href*="/maps/place/"]'
    type: css
    
  # Field selectors (after clicking into detail panel)
  selectors:
    title:
      # Multiple selector strategies (try in order)
      selectors:
        - selector: 'h1.DUwDvf'
          type: css
        - selector: 'h1.fontHeadlineLarge'
          type: css
        - selector: 'div[role="main"] h1'
          type: css
      required: true
      
    category:
      selectors:
        - selector: 'button[jsaction*="category"]'
          type: css
        - selector: 'button.DkEaL'
          type: css
      
    rating:
      selectors:
        - selector: 'span[role="img"][aria-label*="stars"]'
          type: css
          attribute: aria-label
          postprocess: 'regex_extract:[\d.]+'
        - selector: 'div.F7nice span[aria-hidden="true"]'
          type: css
      
    total_reviews:
      selectors:
        - selector: 'span[aria-label*="reviews"]'
          type: css
          attribute: aria-label
          postprocess: 'regex_extract:\d[\d,]*'
        - selector: 'button[aria-label*="reviews"]'
          type: css
          attribute: aria-label
          postprocess: 'regex_extract:\d[\d,]*'
      
    address:
      selectors:
        - selector: 'button[data-item-id="address"]'
          type: css
          attribute: aria-label
          postprocess: 'strip_prefix:Address:'
        - selector: 'button[data-tooltip="Copy address"]'
          type: css
      
    phone:
      selectors:
        - selector: 'button[data-item-id*="phone"]'
          type: css
          attribute: aria-label
          postprocess: 'strip_prefix:Phone:'
        - selector: 'button[data-tooltip="Copy phone number"]'
          type: css
      
    website:
      selectors:
        - selector: 'a[data-item-id="authority"]'
          type: css
          attribute: href
        - selector: 'a[data-tooltip="Open website"]'
          type: css
          attribute: href
      
    email:
      method: extract_email_from_website
      url_field: website

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# EMAIL EXTRACTION (NESTED)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

email_extraction:
  type: regex
  pattern: "[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}"
  
  # Pages to check for email
  crawl_paths:
    - "/"
    - "/contact"
    - "/about"
    
  # Filter rules
  blacklist_domains:
    - example.com
    - domain.com
    - wixpress.com
    - sentry.io
    - googleapis.com
    
  disallow_extensions:
    - png
    - jpg
    - jpeg
    - gif
    - pdf
    - js
    - css
    - svg
    - webp
    - ico
    
  disallow_starts_with_digit: true
  
  # Skip these URL patterns
  skip_urls_containing:
    - google.com
    - facebook.com
    - instagram.com
    - twitter.com
    - linkedin.com

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# OUTPUT CONFIGURATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

output:
  format: json
  
  fields:
    - name: title
      label: "Business Name"
    - name: category
      label: "Category"
    - name: rating
      label: "Rating"
    - name: total_reviews
      label: "Reviews"
    - name: address
      label: "Address"
    - name: phone
      label: "Phone"
    - name: website
      label: "Website"
    - name: email
      label: "Email"
      
  # Search context preservation
  include_context:
    - industry
    - city
    - state
    - country

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# METADATA
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

metadata:
  scraped_at:
    type: string
    format: datetime
    auto: true
    
  schema_id:
    type: string
    value: "google_maps.business"
    
  schema_version:
    type: string
    value: "2.0"
